ğŸ¯ OBJECTIF
Effectuer un **nettoyage sÃ©curisÃ©** du dÃ©pÃ´t : supprimer doublons, fichiers orphelins et dÃ©pendances inutilisÃ©es **sans casser** lâ€™application.
â¡ï¸ Lâ€™opÃ©ration DOIT Ãªtre rÃ©versible (quarantaine + commit), et DOIT finir avec build + tests OK.

âš ï¸ ZONES INTANGIBLES â€” NE RIEN MODIFIER / SUPPRIMER
- RÃ©cents ajouts Supabase/Neon/Drizzle :
  - server/src/db.ts
  - server/src/schema.ts
  - server/src/seed.ts
  - server/src/utils/salon.ts
  - server/src/routes/v1.ts
  - server/src/middlewares/errorHandler.ts
  - server/src/index.ts
  - server/src/server.ts
  - drizzle.config.ts
- Fichiers de config racine : tsconfig.base.json, .eslintrc.cjs, .prettierrc, .gitignore
- Front : client/src/lib/**/*, client/src/hooks/useSalonLoader.ts, client/src/components/ErrorBoundary.tsx, client/src/components/RetryPanel.tsx, client/src/pages/SalonBookingPage.tsx
- Dossiers tests : server/test/**, client/src/**/*.test.ts, client/vite.config.ts, server/vitest.config.ts
- .env* (ne pas committer/supprimer)

ğŸ§­ CHAMP Dâ€™ACTION (AUTORISÃ‰)
- client/src/components/** : composants non utilisÃ©s / doublons visuels
- client/src/assets/** : images/icÃ´nes non rÃ©fÃ©rencÃ©es
- client/src/styles/** : fichiers de styles non importÃ©s
- server/src/** : tout fichier **non importÃ©** (hors zones intangibles listÃ©es)
- racine : artefacts/dossiers temporaires (tmp, __MACOSX, *.zip, rapports obsolÃ¨tes, etc.)
- package.json (client/server) : dÃ©pendances manifestement non utilisÃ©es (aprÃ¨s rapport)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1) SÃ‰CURITÃ‰ & PRÃ‰PARATION
ExÃ©cuter en racine du repo :

git add -A && git commit -m "chore: checkpoint avant nettoyage" || true
git switch -c chore/safe-cleanup || git checkout -b chore/safe-cleanup || true

# Dossier de quarantaine
mkdir -p .attic && touch .attic/.gitkeep

# Installer des outils dâ€™audit (temporairement en devDependencies racine ou localement au besoin)
npm i -D knip depcheck ts-prune @typescript-eslint/parser @typescript-eslint/typescript-estree typescript

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2) AUDIT DES FICHIERS NON RÃ‰FÃ‰RENCÃ‰S
# 2.1 â€” KNIP (fichiers/exports non utilisÃ©s)
npx knip --ignore "server/src/db.ts" --ignore "server/src/schema.ts" --ignore "server/src/seed.ts" --ignore "server/src/utils/**" --ignore "server/src/routes/v1.ts" --ignore "server/src/index.ts" --ignore "server/src/server.ts" --ignore "client/src/lib/**" --ignore "client/src/hooks/useSalonLoader.ts" --ignore "client/src/components/ErrorBoundary.tsx" --ignore "client/src/components/RetryPanel.tsx" --ignore "client/src/pages/SalonBookingPage.tsx" --reporter json > .knip-report.json || true

# 2.2 â€” TS-PRUNE (exports morts cÃ´tÃ© TS/TSX)
npx ts-prune -p tsconfig.base.json --ignore "server/src/(db|schema|seed|utils|routes|index|server).ts" --ignore "client/src/(lib|hooks|components/ErrorBoundary|components/RetryPanel|pages/SalonBookingPage).tsx" > .tsprune-report.txt || true

# 2.3 â€” DEPHECK (dÃ©pendances non utilisÃ©es par package.json courant)
npx depcheck --json > .depcheck-report.json || true

# 2.4 â€” Recherche de doublons exacts (hash) pour assets/components
# (lâ€™agent peut implÃ©menter un petit script Node pour lister fichiers identiques par sha256)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
3) GÃ‰NÃ‰RER UN RAPPORT LISIBLE
CrÃ©er un fichier .cleanup-plan.md avec :
- Liste **proposÃ©e** des fichiers candidats Ã  dÃ©placer en quarantaine (.attic/), groupÃ©s par catÃ©gorie :
  - client/components non importÃ©s
  - client/assets non rÃ©fÃ©rencÃ©s
  - styles non importÃ©s
  - server/src fichiers non importÃ©s (hors zones intangibles)
- Liste **proposÃ©e** des dÃ©pendances Ã  supprimer (client/server), avec la raison (depcheck/knip)
- âš ï¸ Exclure tout ce qui matche les **zones intangibles** ci-dessus.
- Ã‰crire â€œDRYâ€‘RUN ONLYâ€ en tÃªte : aucune suppression rÃ©elle Ã  cette Ã©tape.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
4) DÃ‰PLACEMENT EN QUARANTAINE (PAS DE SUPPRESSION DIRECTE)
Pour chaque fichier listÃ© dans .cleanup-plan.md :
- VÃ©rifier une derniÃ¨re fois quâ€™il nâ€™est importÃ© nulle part (recherche `import` / `require` dans le repo).
- Le **dÃ©placer** vers `.attic/<mÃªme-chemin>` (conserver lâ€™arborescence).
- Ajouter une ligne dans `.attic/INDEX.md` avec la date/heure et la raison (ex: â€œnon rÃ©fÃ©rencÃ© selon knip + ts-pruneâ€).

Commandes (pseudocode bash) :
# exemple
mkdir -p ".attic/client/src/components/legacy"
git mv "client/src/components/legacy/OldWidget.tsx" ".attic/client/src/components/legacy/OldWidget.tsx" || true

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5) MISE Ã€ JOUR DES IMPORTS Ã‰VIDENTS (DÃ‰DOUBLONNAGE)
- Si des composants en double existent (ex: BottomNavigationLegacy.tsx vs BottomNavigation.tsx) :
  - **Garder** la version utilisÃ©e par la page active (SalonBookingPage / App).
  - **DÃ©placer** lâ€™autre en quarantaine.
- Remplacer dâ€™Ã©ventuels imports rÃ©siduels qui pointent vers lâ€™ancienne version par la version gardÃ©e.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6) DÃ‰PENDANCES INUTILISÃ‰ES (PRUDENCE)
- Lire `.depcheck-report.json`.
- **Ne dÃ©sinstaller** que les paquets clairement non utilisÃ©s ET non nÃ©cessaires aux scripts.
- Exclusions (ne jamais retirer si prÃ©sents) : typescript, eslint, prettier, vitest, supertest, @types/*, @typescript-eslint/*, @vitejs/plugin-react, tsx, tsup, drizzle-orm, drizzle-kit, @neondatabase/serverless, @supabase/supabase-js, react, react-dom, zod.

Exemple :
# client
cd client && npm remove <pkg1> <pkg2> || true && cd ..
# server
cd server && npm remove <pkg1> <pkg2> || true && cd ..

Puis :
npm prune --workspaces || true

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
7) VÃ‰RIFICATIONS BLOQUANTES (NE PAS SKIPPER)
# Lint + Types (client puis server)
cd client && npm run lint && npm run typecheck || exit 1
cd ../server && npm run lint && npm run typecheck || exit 1
cd ..

# Tests
npm --prefix server test || exit 1
npm --prefix client test || true  # OK si tu nâ€™as que peu de tests front

# Build (optionnel mais conseillÃ©)
npm --prefix client run build || exit 1
npm --prefix server run build || exit 1

Si une Ã©tape Ã©choue :
- **Annuler le dernier dÃ©placement problÃ©matique** (ramener le/les fichier(s) depuis `.attic/` Ã  leur place dâ€™origine).
- Relancer la vÃ©rification.
- Mettre Ã  jour `.cleanup-plan.md` en consÃ©quence.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
8) COMMIT & TRACE
git add -A
git commit -m "chore(cleanup): dÃ©placer en quarantaine le code orphelin + prune deps (build/tests OK)"

# Optionnel : ouvrir une PR interne ou noter la liste des fichiers en .attic/INDEX.md
# AprÃ¨s quelques jours sans rÃ©gression, on pourra supprimer dÃ©finitivement le contenu de .attic/

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
RÃˆGLES DE SÃ‰CURITÃ‰ (Ã€ RESPECTER STRICTEMENT)
- JAMAIS de suppression dÃ©finitive dans `server/src` sans passage par `.attic/` + vÃ©rifications rÃ©ussies.
- NE PAS toucher aux fichiers/dirs listÃ©s en zone intangible.
- NE PAS modifier la logique seed/fallback ni les routes `/api/v1` dÃ©jÃ  stabilisÃ©es.
- SI doute sur un fichier, le laisser tel quel (ou juste le dÃ©placer en .attic/).
- Toujours finir par : lint 0 warning, typecheck 0 erreur, tests OK, build OK.

âœ… RÃ‰SULTAT ATTENDU
- RÃ©duction nette du bruit (composants/actifs/styles orphelins mis en quarantaine)
- package.json (client/server) allÃ©gÃ©s des dÃ©pendances rÃ©ellement inutiles
- Lâ€™application dÃ©marre, passe lint/type/tests/build sans erreur
- CapacitÃ© Ã  **revenir en arriÃ¨re** grÃ¢ce Ã  `.attic/` + commit dÃ©diÃ©
