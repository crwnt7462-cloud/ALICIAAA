ğŸ¯ OBJECTIF
Ã‰liminer le message â€œFailed to fetchâ€ lors de la prise de RDV en :
1. VÃ©rifiant que `VITE_API_URL` est dÃ©fini et correct
2. Auto-dÃ©tectant lâ€™URL de lâ€™API (Replit/localhost) si `VITE_API_URL` est vide ou incorrect
3. Utilisant cette URL dÃ©tectÃ©e dans tout le front
4. Affichant un message clair si le serveur API est down

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1) CRÃ‰ER Lâ€™UTILITAIRE DE VÃ‰RIFICATION ET DÃ‰TECTION
CrÃ©er/Ã©craser `client/src/lib/apiHealth.ts` :

export async function checkApiHealth(apiUrl: string): Promise<boolean> {
  try {
    const cleanUrl = apiUrl.replace(/\/+$/, '');
    const res = await fetch(`${cleanUrl}/health`, { method: 'GET' });
    if (!res.ok) return false;
    const json = await res.json().catch(() => null);
    return Boolean(json && (json.ok === true || json.status === 'ok'));
  } catch {
    return false;
  }
}

export async function autoDetectApiUrl(): Promise<string | null> {
  try {
    const host = location.hostname;
    // Cas Replit
    if (host.includes('repl.co')) {
      const candidate = `${location.protocol}//${host}`;
      const ok = await checkApiHealth(candidate);
      if (ok) return candidate;
    }
    // Cas localhost
    const localhostUrl = 'http://localhost:3000';
    const okLocal = await checkApiHealth(localhostUrl);
    if (okLocal) return localhostUrl;
  } catch {
    return null;
  }
  return null;
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2) VÃ‰RIFICATION ET AUTO-DÃ‰TECTION AU DÃ‰MARRAGE
Dans `client/src/main.tsx` (ou le point dâ€™entrÃ©e du front), **avant le rendu React**, ajouter :

import { checkApiHealth, autoDetectApiUrl } from './lib/apiHealth';

(async () => {
  let apiUrl = import.meta.env.VITE_API_URL;

  if (!apiUrl) {
    console.warn('[Startup] VITE_API_URL manquant, tentative dâ€™auto-dÃ©tectionâ€¦');
    const detected = await autoDetectApiUrl();
    if (detected) {
      apiUrl = detected;
      (window as any).__API_URL__ = apiUrl;
      console.log(`[Startup] API dÃ©tectÃ©e automatiquement : ${apiUrl}`);
    }
  }

  if (!apiUrl) {
    alert('âš  Impossible de trouver lâ€™URL API.\nVÃ©rifie VITE_API_URL ou dÃ©marre le serveur.');
    return;
  }

  const ok = await checkApiHealth(apiUrl);
  if (!ok) {
    console.warn(`[Startup] API inaccessible Ã  ${apiUrl}, tentative de re-dÃ©tectionâ€¦`);
    const detected = await autoDetectApiUrl();
    if (detected && detected !== apiUrl) {
      apiUrl = detected;
      (window as any).__API_URL__ = apiUrl;
      console.log(`[Startup] API re-dÃ©tectÃ©e : ${apiUrl}`);
      const ok2 = await checkApiHealth(apiUrl);
      if (!ok2) {
        alert(`âš  Impossible de contacter lâ€™API Ã  ${apiUrl} (mÃªme aprÃ¨s dÃ©tection).\nVÃ©rifie que le serveur est dÃ©marrÃ©.`);
      }
    } else {
      alert(`âš  Impossible de contacter lâ€™API Ã  ${apiUrl}.\nVÃ©rifie que le serveur est dÃ©marrÃ© et accessible.`);
    }
  } else {
    console.log('[Startup] API connectÃ©e avec succÃ¨s.');
  }
})();

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
3) UTILISER Lâ€™URL DÃ‰TECTÃ‰E PARTOUT
Partout dans le front oÃ¹ il y a :
import.meta.env.VITE_API_URL
remplacer par :
(window as any).__API_URL__ ?? import.meta.env.VITE_API_URL

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
4) AJOUTER LA ROUTE HEALTH SI ABSENTE
Dans `server/src/routes/v1.ts` ou routeur principal, si non prÃ©sent, ajouter :

router.get('/health', (req, res) => {
  res.json({ ok: true });
});

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… RÃ‰SULTAT ATTENDU
- Si `.env` front est correct â†’ aucun changement
- Si `.env` est vide ou faux â†’ auto-dÃ©tection de lâ€™URL Replit/localhost
- Si API down â†’ message clair au lieu de â€œFailed to fetchâ€
- Aucun impact sur la logique de rÃ©servation et fallback dÃ©jÃ  en place